{% extends 'trackingtalibe/base.html' %}
{% block title %}Gestion des associations{% endblock %}

{% block content %}
<div class="container d-flex justify-content-center align-items-center" style="min-height: 90vh;">
  <div class="col-lg-10 p-4" style="background: #ffffff; border-radius: 15px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
    
    <!-- ðŸ”— Bloc : demandes en attente -->
    <h4 class="text-center mb-3 fw-bold text-primary">Demandes dâ€™association en attente</h4>
    {% if demandes %}
      <div class="table-responsive mb-4">
        <table class="table table-bordered table-hover table-sm text-center align-middle">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th>Nom de lâ€™enfant</th>
              <th>Demandeur</th>
              <th>RÃ´le</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for demande in demandes %}
              <tr>
                <td>{{ demande.enfant.id_esp32 }}</td>
                <td>{{ demande.enfant.prenom }} {{ demande.enfant.nom }}</td>
                <td>{{ demande.utilisateur.first_name }} {{ demande.utilisateur.last_name }}</td>
                <td>{{ demande.utilisateur.get_role_display }}</td>
                <td>
                  <a href="{% url 'accepter_demande' demande.id %}" class="btn btn-success btn-sm">Accepter</a>
                  <a href="{% url 'refuser_demande' demande.id %}" class="btn btn-danger btn-sm">Refuser</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-center text-muted mb-4">Aucune demande d'association en attente.</p>
    {% endif %}

    <hr>

    <!-- âœ… Bloc : utilisateurs associÃ©s -->
    <h4 class="text-center mb-3 fw-bold text-primary">Utilisateurs associÃ©s Ã  vos talibÃ©s</h4>
    {% if associations %}
      <div class="table-responsive mb-3">
        <table class="table table-bordered table-hover table-sm text-center align-middle">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th>Nom de lâ€™enfant</th>
              <th>Utilisateur</th>
              <th>RÃ´le</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for assoc in associations %}
              <tr>
                <td>{{ assoc.enfant.id_esp32 }}</td>
                <td>{{ assoc.enfant.prenom }} {{ assoc.enfant.nom }}</td>
                <td>{{ assoc.utilisateur.first_name }} {{ assoc.utilisateur.last_name }}</td>
                <td>{{ assoc.utilisateur.get_role_display }}</td>
                <td>
                  <form method="post" action="{% url 'dissocier_utilisateur' assoc.enfant.id assoc.utilisateur.id %}" onsubmit="return confirm('Confirmer la dissociation ?')">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-warning btn-sm">Dissocier</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-center text-muted">Aucune association active.</p>
    {% endif %}

  </div>
</div>
{% endblock %}