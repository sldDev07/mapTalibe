{% extends 'trackingtalibe/base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<style>
  .btn-blue-outline {
    background-color: rgb(25, 0, 255);
    color: #ffffff;
    border: none;
    font-weight: bold;
  }
</style>
<div class="container d-flex justify-content-center align-items-center" style="min-height: 90vh;">
  <div class="col-md-6 p-4" style="background: #ffffff; border-radius: 15px; box-shadow: 0 0 10px rgba(0,0,0,0.1); border-left: 3px solid #cd47e7; border-right: 3px solid #cd47e7;">
    <h3 class="text-center mb-3" style="font-weight: bold; color: #2b2b2b;">🔐 S'associer à un enfant</h3>
    <p class="text-center text-muted" style="font-size: 0.95rem;">
      Entrez l’<strong>ID de l’enfant</strong> pour soumettre une demande au Serigne Daara.
    </p>

    <form method="post">
      {% csrf_token %}
      {% for field in form %}
        <div class="mb-3">
          {{ field|as_crispy_field }}
          <style>
            {{ field.auto_id }}_helptext { display: none; }
          </style>
          {% if field.errors %}
            <div class="text-danger">{{ field.errors }}</div>
          {% endif %}
        </div>
      {% endfor %}

      <div class="d-grid mt-4">
        <button type="submit" class="btn btn-blue-outline badge rounded-pill" style="font-size: medium; border-bottom: 3px solid #cd47e7;">Envoyer la demande</button>
      </div>
    </form>

    {% if demandes_existantes %}
    <hr class="mt-5 mb-3">
    <h6 class="text-center text-dark">📋 Vos demandes en attente</h6>
    <div class="table-responsive mt-2">
      <table class="table table-striped table-hover small text-center">
        <thead class="table-light sticky-top">
          <tr>
            <th>Enfant</th>
            <th>Daara</th>
            <th>Date</th>
            <th>Statut</th>
          </tr>
        </thead>
        <tbody>
          {% for demande in demandes_existantes %}
          <tr>
            <td>{{ demande.enfant.nom }} {{ demande.enfant.prenom }}</td>
            <td>{{ demande.enfant.responsable.nom_daara }}</td>
            <td>{{ demande.date|date:"d/m/Y H:i" }}</td>
            <td><span class="badge bg-warning text-dark">En attente</span></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-center mt-4 text-muted">
      <em>Vous n'avez aucune demande en attente.</em>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}